# -*- coding: utf-8 -*-
import os
from dotenv import load_dotenv

# 환경 변수 로드 (로컬 개발 환경용)
load_dotenv()

# Vercel에 배포할 때는 환경 변수에서 토큰을 가져옵니다
BOT_TOKEN = os.environ.get("BOT_TOKEN", "YOUR_BOT_TOKEN")
WEBHOOK_URL = os.environ.get("WEBHOOK_URL", "")  # Vercel 배포 URL

# 사용자별 대화 기록을 저장할 딕셔너리
user_conversations = {}
# 사용자별 마지막 선언 시간 저장
last_declaration_time = {}
# 사용자별 캐릭터 정보 저장
user_characters = {}

# 캐릭터 관련 상수
CHARACTER_DIR = 'characters'

# 캐릭터 시트 템플릿 - 필수 항목 정의
CHARACTER_TEMPLATE = {
    "세션_정보": {
        "플레이어_수": 1,
        "완성된_캐릭터_수": 0,
        "현재_캐릭터_인덱스": 0
    },
    "완성된_캐릭터들": [],  # 완성된 모든 캐릭터 정보를 저장할 배열
    "이름": None,
    "클래스": None,
    "레벨": 1,
    "경험치": 0,
    "가치관": None,
    "플레이어": None,  # 플레이어 정보 (user_id 또는 이름)
    "능력치": {
        "근력": None,
        "민첩성": None,
        "건강": None,
        "지능": None,
        "지혜": None,
        "매력": None
    },
    "수정치": {},  # 능력치에 따라 자동 계산됨
    "체력": {
        "최대": None,  # 클래스와 건강 수정치에 따라 자동 계산됨
        "현재": None,
        "체력주사위": None  # 클래스에 따라 자동 설정됨
    },
    "장갑클래스": None,  # 계산됨
    "기본공격보너스": None,  # 클래스에 따라 자동 설정됨
    "행동순서": None,  # 계산됨
    "기능": [],
    "언어": ["공용어"],  # 추가 언어는 지능 수정치에 따라 추가됨
    "행운점수": {
        "최대": None,  # 클래스에 따라 자동 설정됨
        "현재": None
    },
    "장비": {
        "착용가능갑옷": [],  # 클래스에 따라 자동 설정됨
        "소지품": ["간편한 옷", "모험 장비"],
        "무기": [],
        "갑옷": "없음",
        "소지금": {
            "동화": 0,
            "은화": None,  # 랜덤 생성됨 (4d6)
            "금화": 0
        }
    },
    "생성일": None,
    "마지막수정일": None
}

# 클래스별 기본 설정값
CLASS_DEFAULTS = {
    "전사": {
        "체력주사위": "d10",
        "행운점수": 3,
        "기본공격보너스": 1,
        "행동순서_보너스": 1,
        "착용가능갑옷": ["가죽 갑옷", "사슬 갑옷", "사슬+흉판", "전신 판금"]
    },
    "도적": {
        "체력주사위": "d8",
        "행운점수": 5,
        "기본공격보너스": 0,
        "행동순서_보너스": 2,
        "착용가능갑옷": ["가죽 갑옷", "사슬 갑옷"]
    },
    "마법사": {
        "체력주사위": "d6",
        "행운점수": 3,
        "기본공격보너스": 0,
        "행동순서_보너스": 0,
        "착용가능갑옷": []
    }
}

# 다음에 물어볼 항목 순서
CREATION_SEQUENCE = [
    "이름", "클래스", "가치관", "능력치", "기능"
] 